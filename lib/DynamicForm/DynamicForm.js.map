{"version":3,"sources":["../../components/DynamicForm/DynamicForm.jsx"],"names":["React","Component","_","FormEx","Button","Row","Modal","formNode","viewNode","defaultItem","type","label","bind","render","children","canEdit","required","rule","defaultValue","keyText","valueText","options","selectLabel","selectBind","rowKey","span","addText","withEditCol","addTitle","editTitle","delConfirm","tokenSeparators","layout","labelCol","xs","sm","wrapperCol","DynamicForm","props","get","values","getOfState","state","renderView","doms","items","item","Object","assign","onArrayChildEdit","onArrayChildDel","node","gutter","push","Children","toArray","renderForm","getValues","setChange","onValuesChange","form","renderArrayChildForm","arrayItem","cloneDeep","arrayChildItem","index","arrayChildIndex","opt","child","console","log","key","value","setState","onFormEdit","modalVisible","id","title","find","x","undefined","currentValues","length","arrayChildModal","arrayChildModalTitle","arrayChildId","onArrayChildAdd","list","splice","onSubmit","onFormSubmit","confirmLoading","onFormCancel","deepClone","cloneElements","forEach","element","isPlainObject","name","htmlType","cloneElement","onClick","nextProps","className","padding","defaultProps"],"mappings":"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","file":"DynamicForm.js","sourcesContent":["/**\r\n * 动态表单及显示\r\n */\r\nimport React, { Component } from 'react';\r\nimport _ from 'lodash';\r\nimport { FormEx } from 'src/components';\r\nimport { Button, Row, Modal } from 'antd';\r\n\r\nimport { formNode, viewNode } from './controls.jsx';\r\n\r\nconst defaultItem = {\r\n  type: 'input', //string, input||radio||checkbox||select||oneOf 多项只能配置一项||array列表项||br换行||selectTag多重输入\r\n  label: '', // 标题文本\r\n  bind: null, // 显示及编辑时对应数据中的索引\r\n  render: null, // 显示时处理函数\r\n  children: null, // array, array 中子节点\r\n  canEdit: true, // 当前项是否可编辑\r\n  required: false, // 编辑时是否必填\r\n  rule: [], // 编辑时校验规则\r\n  defaultValue: null, // 默认值\r\n  // Object 两个文本框实现键值对形式 \r\n  keyText: 'key', // key值文本框文本 \r\n  valueText: 'value', // value 文本框显示文本\r\n  // select\r\n  options: null,\r\n  selectLabel: null, // 对应selectEx组件中 label\r\n  selectBind: null, // 对应selectEx组件中 bind\r\n  // array可选参数 参照 FormExItemArray的参数\r\n  rowKey: null, // table显示时的rowKey\r\n  span: null, // 编辑时布局\r\n  addText: '新增', // 编辑时新增文本\r\n  withEditCol: false, // 是否添加编辑列\r\n  addTitle: null, // 添加标题\r\n  editTitle: null, // 编辑标题\r\n  delConfirm: null, // 删除前确认信息\r\n  // selectTag\r\n  tokenSeparators: [','], // 分隔符\r\n}\r\n\r\nconst layout = {\r\n  labelCol: {\r\n    xs: { span: 12 },\r\n    sm: { span: 4 },\r\n  },\r\n  wrapperCol: {\r\n    xs: { span: 12 },\r\n    sm: { span: 18 },\r\n  },\r\n};\r\n\r\nexport default class DynamicForm extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      values: _.cloneDeep(props.values), // 用于编辑使用\r\n    };\r\n  }\r\n\r\n  static defaultProps = {\r\n    title: '', // 编辑时弹窗标题\r\n    values: {}, // 完整数据\r\n    items: [], // 配置项 \r\n    onSubmit: (values) => {}, // 编辑保存时提交事件\r\n    gutter: 16, // row内填充\r\n    span: 8, // 单个元素占据多大 总共24\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps) {}\r\n\r\n  componentDidMount() {}\r\n\r\n  get = (bind, defaultValue) => {\r\n    return _.get(this.props.values, bind, defaultValue);\r\n  }\r\n\r\n  getOfState = (bind, defaultValue) => {\r\n    return _.get(this.state.values, bind, defaultValue);\r\n  }\r\n\r\n  // 显示生成\r\n  renderView = () => {\r\n    let doms = [];\r\n    for (let item of this.props.items) {\r\n      item = Object.assign({}, defaultItem, item);\r\n      item.onArrayChildEdit = this.onArrayChildEdit;\r\n      item.onArrayChildDel = this.onArrayChildDel;\r\n      let node = viewNode({\r\n        layout,\r\n        item,\r\n        values: this.props.values,\r\n        get: this.get,\r\n        defaultItem,\r\n        gutter: this.props.gutter,\r\n        span: this.props.span\r\n      });\r\n      doms.push(node);\r\n    }\r\n    return React.Children.toArray(doms);\r\n  }\r\n\r\n  // 表单生成\r\n  renderForm = () => {\r\n    let doms = [];\r\n    for (let item of this.props.items) {\r\n      item = Object.assign({}, defaultItem, item);\r\n      if (!item.canEdit) continue;\r\n\r\n      let node = formNode({\r\n        layout,\r\n        item,\r\n        values: this.props.values,\r\n        get: this.getOfState,\r\n        getValues: () => this.state.values,\r\n        defaultItem,\r\n        setChange: this.onValuesChange\r\n      });\r\n      doms.push(node);\r\n    }\r\n    let form = <FormEx values={this.state.values} onChange={this.onValuesChange}>{React.Children.toArray(doms)}</FormEx>\r\n    return form;\r\n  }\r\n\r\n  // 生成数组数据单项添加表单，默认情况下，index存在为编辑，不存在为添加\r\n  renderArrayChildForm = () => {\r\n    let arrayItem = _.cloneDeep(this.state.arrayChildItem); // 每次页面刷新都会操作items，必须拷贝一份\r\n    let index = this.state.arrayChildIndex;\r\n    let doms = [];\r\n\r\n    // console.log(arrayItem);\r\n    // console.log(index);\r\n    // console.log(this.state.values);\r\n\r\n    for (let item of arrayItem.children) {\r\n      item.bind = `${arrayItem.bind}[${index}].${item.bind}`;\r\n      if (item.type === 'oneOf' && item.children) {\r\n        for (let opt of item.children) {\r\n          for (let child of opt.children) {\r\n            console.log(child);\r\n            child.bind = `${arrayItem.bind}[${index}].${child.bind}`\r\n          }\r\n        }\r\n      }\r\n      let node = formNode({\r\n        layout,\r\n        item,\r\n        values: this.props.values,\r\n        get: this.getOfState,\r\n        getValues: () => this.state.values,\r\n        defaultItem,\r\n        setChange: this.onValuesChange\r\n      });\r\n      doms.push(node);\r\n    }\r\n    let form = <FormEx values={this.state.values} onChange={this.onValuesChange}>{React.Children.toArray(doms)}</FormEx>\r\n    return form;\r\n  }\r\n\r\n  onValuesChange = (values, key, value) => {\r\n    // console.log(values);\r\n    // console.log(key);\r\n    // console.log(value);\r\n    this.setState({\r\n      values: values\r\n    });\r\n  }\r\n\r\n  onFormEdit = () => {\r\n    this.setState({\r\n      modalVisible: true,\r\n      values: _.cloneDeep(this.props.values), // 编辑的数据重置\r\n    });\r\n  }\r\n\r\n  // 数组添加元素接口, 。id对应数据中的数组索引，默认为第一个array属性\r\n  onArrayChildEdit = (id, index) => {\r\n    let arrayItem, title;\r\n    if (id) {\r\n      arrayItem = _.cloneDeep(this.props.items.find(x => x.bind === id))\r\n    } else {\r\n      arrayItem = _.cloneDeep(this.props.items.find(x => x.type === 'array'));\r\n    }\r\n    // console.log(arrayItem);\r\n    if (!arrayItem) {\r\n      console.log('未找到可编辑数据');\r\n      return;\r\n    }\r\n    if (index !== undefined) {\r\n      title = arrayItem.editTitle ? arrayItem.editTitle : this.props.title + '编辑';\r\n    } else {\r\n      title = arrayItem.addTitle ? arrayItem.editTitle : this.props.title + '添加';\r\n    }\r\n    let currentValues = this.get(arrayItem.bind, []);\r\n    index = index === undefined ? currentValues.length : index;\r\n    // console.log(index);\r\n    this.setState({\r\n      values: _.cloneDeep(this.props.values),\r\n      arrayChildModal: true,\r\n      arrayChildModalTitle: title,\r\n      arrayChildId: id,\r\n      arrayChildItem: arrayItem,\r\n      arrayChildIndex: index,\r\n    });\r\n  }\r\n\r\n  onArrayChildAdd = (id) => {\r\n    this.onArrayChildEdit(id);\r\n  }\r\n\r\n  onArrayChildDel = (id, index) => {\r\n    let arrayItem;\r\n    if (id) {\r\n      arrayItem = _.cloneDeep(this.props.items.find(x => x.bind === id))\r\n    } else {\r\n      arrayItem = _.cloneDeep(this.props.items.find(x => x.type === 'array'));\r\n    }\r\n    if (!arrayItem) {\r\n      console.log('未找到可编辑数据');\r\n      return;\r\n    }\r\n    let values = _.cloneDeep(this.props.values);\r\n    let list = _.get(values, arrayItem.bind);\r\n    list.splice(index, 1);\r\n    this.props.onSubmit(values, () => {});\r\n    //let info = arrayItem.delConfirm ? arrayItem.editTitle : '确定删除该条目吗？';\r\n    // Modal.confirm({\r\n    //   content: info,\r\n    //   onOk: () => {\r\n\r\n    //   }\r\n    // });\r\n  }\r\n\r\n  // 弹窗确定按钮事件\r\n  onFormSubmit = () => {\r\n    // console.log(this.state.values);\r\n    // return;\r\n    // let data;\r\n    // if (typeof(this.props.formatSubmitData) === 'function') {\r\n    //   data = this.props.formatSubmitData(_.deepClone(this.state.values));\r\n    // } \r\n    this.setState({\r\n      confirmLoading: true,\r\n    });\r\n    this.props.onSubmit(this.state.values, () => {\r\n      this.onFormCancel();\r\n    });\r\n  }\r\n\r\n  onFormCancel = () => {\r\n    this.setState({\r\n      modalVisible: false,\r\n      arrayChildModal: false,\r\n      confirmLoading: false,\r\n    });\r\n  }\r\n\r\n  // 遍历子节点，获取htmlType === 'submit'的按钮，绑定form编辑事件\r\n  deepClone = (doms) => {\r\n    let cloneElements = [];\r\n    React.Children.toArray(doms).forEach((element, index) => {\r\n      if (!_.isPlainObject(element)) {\r\n        cloneElements.push(element);\r\n      } else if (element.type.name === Button.name && element.props.htmlType === 'submit') {\r\n        cloneElements.push(React.cloneElement(element, {\r\n          onClick: this.onFormEdit\r\n        }));\r\n      } else {\r\n        let children = this.deepClone(element.props.children);\r\n        cloneElements.push(React.cloneElement(element, null, children));\r\n      }\r\n    });\r\n    return cloneElements;\r\n  }\r\n\r\n  render() {\r\n    let children = this.deepClone(this.props.children);\r\n\r\n    return (\r\n      <div className={this.props.className}>\r\n        {children}\r\n        <div style={{padding: '0 8px'}}>\r\n          <Row gutter={this.props.gutter}>\r\n            {this.renderView()}\r\n          </Row>\r\n        </div>\r\n        { this.state.modalVisible && \r\n          <Modal\r\n            title={this.props.title}\r\n            visible={true}\r\n            confirmLoading={this.state.confirmLoading}\r\n            onOk={this.onFormSubmit}\r\n            onCancel={this.onFormCancel}\r\n            okText=\"保存\"\r\n            cancelText=\"取消\"\r\n            width=\"800px\"\r\n          >\r\n            {this.renderForm()}\r\n          </Modal>\r\n        }\r\n        { this.state.arrayChildModal && \r\n          <Modal\r\n            title={this.state.arrayChildModalTitle}\r\n            visible={true}\r\n            confirmLoading={this.state.confirmLoading}\r\n            onOk={this.onFormSubmit}\r\n            onCancel={this.onFormCancel}\r\n            okText=\"保存\"\r\n            cancelText=\"取消\"\r\n            width=\"800px\"\r\n          >\r\n            {this.renderArrayChildForm()}\r\n          </Modal>\r\n        }\r\n      </div>\r\n    )\r\n  }\r\n}\r\n"]}