{"version":3,"sources":["../../components/FormEx/FormEx.jsx"],"names":["React","Component","Form","Row","Col","Button","Icon","Checkbox","Input","Select","_","Schema","FormItem","Item","TextArea","_name","FormEx","props","onFormValidate","cb","results","count","items","x","onValidate","undefined","push","res","length","every","status","onSubmit","values","onChange","key","value","cloneDeep","set","deepClone","doms","cloneElements","Children","toArray","forEach","element","index","childProps","isObject","htmlType","onClick","e","preventDefault","cloneElement","type","FormExItem","bind","defaultValues","defaultValue","get","ruleOfForm","rules","ref","item","emitChangeToParent","getValues","FormExItemArray","children","setDefaultValues","isEqual","state","defaultProps","data","validate","rule","message","descriptor","validator","errors","fields","result","isArray","concat","isPlainObject","required","setState","target","lastValues","checked","mode","onAddItem","list","onDelItem","splice","span","s","Math","floor","fill","Array","i","cols","id","marginLeft","row","paddingBottom","width","addText","ItemArray"],"mappings":"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","file":"FormEx.js","sourcesContent":["import React, { Component } from 'react';\r\nimport { Form, Row, Col, Button, Icon, Checkbox, Input, Select } from 'antd';\r\nimport _ from 'lodash';\r\nimport Schema from 'async-validator';\r\nimport './form.scss';\r\n\r\nconst FormItem = Form.Item;\r\nconst TextArea = Input.TextArea;\r\nCheckbox._name = 'Checkbox';\r\nInput._name = 'Input';\r\nSelect._name = 'Select';\r\nTextArea._name = 'TextArea';\r\n\r\nexport default class FormEx extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {};\r\n    this.values = {};\r\n  }\r\n\r\n  static defaultProps = {\r\n    onSubmit: () => {}, // 提交事件，进行校验\r\n    onChange: (values, data, key) => {}, // 所有控件变更都会触发该事件\r\n    rules: {}, // 表单校验规则\r\n    values: {}, // 表单初始数据\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.setDefaultValues(this.defaultValues);\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    // 每次更新时，对未设置的字段进行数据初始化\r\n    this.setDefaultValues(this.defaultValues);\r\n  }\r\n\r\n  // submit btn事件，针对所有表单空间校验并进行回调\r\n  onFormValidate = (cb) => {\r\n    let results = [];\r\n    let count = 0;\r\n    for (let x of this.items) {\r\n      if (x.onValidate) {\r\n        count = count + 1;\r\n      }\r\n    }\r\n    for (let x of this.items) {\r\n      if (x.onValidate) {\r\n        x.onValidate(undefined, res => {\r\n          results.push(res);\r\n          if (results.length === count && results.every(x => x.status === 'success')) {\r\n            this.props.onSubmit(this.props.values, cb);\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  // 调用form外部的事件\r\n  onChange = (values, key, value) => {\r\n    // 合并数据\r\n    if (!values && key) {\r\n      values = _.cloneDeep(this.props.values);\r\n      _.set(values, key, value);\r\n    }\r\n    this.props.onChange(values, key, value);\r\n  }\r\n\r\n  deepClone = (doms) => {\r\n    let cloneElements = [];\r\n    React.Children.toArray(doms).forEach((element, index) => {\r\n      let childProps = {};\r\n      // 纯文字组件处理\r\n      if (!_.isObject(element)) {\r\n        cloneElements.push(element);\r\n      }\r\n      // submit 按钮处理 数据校验\r\n      else if (element.props && element.props.htmlType === 'submit') {\r\n        childProps = {\r\n          onClick: (e) => {\r\n            e.preventDefault();\r\n            this.onFormValidate();\r\n          }\r\n        }\r\n        cloneElements.push(React.cloneElement(element, childProps));\r\n      }\r\n      // 表单控件处理\r\n      else if (element.type._name === FormExItem._name && element.props.bind) {\r\n        // 初始化数据提取，之后统一设置（单独设置无法实现）\r\n        this.defaultValues.push({ bind: element.props.bind, defaultValue: element.props.defaultValue });\r\n        childProps = {\r\n          value: _.get(this.props.values, element.props.bind),\r\n          ruleOfForm: this.props.rules[element.props.bind],\r\n          ref: item => {\r\n            if (item)\r\n              this.items.push(item);\r\n          },\r\n          items: this.items,\r\n          values: this.props.values,\r\n          rules: this.props.rules,\r\n          emitChangeToParent: this.onChange,\r\n          getValues: () => this.props.values,\r\n          defaultValue: element.props.defaultValue\r\n        };\r\n        cloneElements.push(React.cloneElement(element, childProps));\r\n      }\r\n      // 数组 表单控件处理\r\n      else if (element.type._name === FormExItemArray._name && element.props.bind) {\r\n        // 初始化数据提取，之后统一设置（单独设置无法实现）\r\n        this.defaultValues.push({ bind: element.props.bind, defaultValue: element.props.defaultValue });\r\n        childProps = {\r\n          value: _.get(this.props.values, element.props.bind),\r\n          ruleOfForm: this.props.rules[element.props.bind],\r\n          items: this.items,\r\n          defaultValues: this.defaultValues,\r\n          emitChangeToParent: this.onChange,\r\n          getValues: () => this.props.values,\r\n          values: this.props.values,\r\n          rules: this.props.rules,\r\n          defaultValue: element.props.defaultValue\r\n        };\r\n        cloneElements.push(React.cloneElement(element, childProps));\r\n      }\r\n      // 非表单节点处理 递归处理\r\n      else {\r\n        let children = this.deepClone(element.props.children);\r\n        cloneElements.push(React.cloneElement(element, null, children));\r\n      }\r\n    });\r\n    if (cloneElements.length === 1) {\r\n      return cloneElements[0];\r\n    }\r\n    return cloneElements;\r\n  }\r\n\r\n  setDefaultValues = (defaultValues) => {\r\n    let values = _.cloneDeep(this.props.values);\r\n    for (let x of defaultValues) {\r\n      if (x.defaultValue !== undefined && _.get(values, x.bind) === undefined) {\r\n        _.set(values, x.bind, x.defaultValue);\r\n      }\r\n    }\r\n    if (!_.isEqual(this.props.values, values)) {\r\n      this.onChange(values);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    this.items = [];\r\n    this.defaultValues = [];\r\n    let children = this.deepClone(this.props.children);\r\n    // console.log(children);\r\n    return (\r\n      <Form>\r\n        {children}\r\n      </Form>\r\n    )\r\n  }\r\n}\r\n\r\nfunction validate(rule, value, key, cb) {\r\n  if (!rule) {\r\n    return;\r\n  }\r\n  if (rule.length === 0) {\r\n    cb && cb({\r\n      status: 'success',\r\n      message: ''\r\n    });\r\n    return;\r\n  }\r\n  let descriptor = {\r\n    [key]: rule\r\n  };\r\n  let validator = new Schema(descriptor);\r\n  validator.validate({\r\n    [key]: value\r\n  }, (errors, fields) => {\r\n    let result = {\r\n      status: 'success',\r\n      message: ''\r\n    };\r\n    if (errors) {\r\n      result = {\r\n        status: 'error',\r\n        message: errors[0].message\r\n      };\r\n    }\r\n    cb && cb(result);\r\n  });\r\n}\r\n\r\nclass FormExItem extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      status: '', // success error\r\n      message: '',\r\n    };\r\n  }\r\n\r\n  static defaultProps = {\r\n    bind: undefined, // 对应表单数据中的key\r\n    onChange: undefined, // 单独事件处理 (values, key, value) => { return values; } 返回的values将作为表单全局onchange事件的第一个参数，如果返回null，则会生成默认数据\r\n    rule: undefined, // 单独规则\r\n    required: false, // 是否必填\r\n    defaultValue: undefined, // 默认值\r\n  }\r\n\r\n  componentDidMount() {}\r\n\r\n  // 校验接口，在 FormEx 中可能会调用\r\n  onValidate = (value, cb) => {\r\n    value = value === undefined ? this.props.value : value;\r\n    // 生成规则 优先级 默认规则（是否必填） < 全局规则 < 自身规则  \r\n    let rule = [];\r\n\r\n    if (this.props.ruleOfForm) {\r\n      if (_.isArray(this.props.ruleOfForm))\r\n        rule = rule.concat(this.props.ruleOfForm);\r\n      else if (_.isPlainObject(this.props.ruleOfForm)) {\r\n        rule.push(this.props.ruleOfForm);\r\n      }\r\n    }\r\n    if (this.props.rule) {\r\n      if (_.isArray(this.props.rule))\r\n        rule = rule.concat(this.props.rule);\r\n      else if (_.isPlainObject(this.props.rule))\r\n        rule.push(this.props.rule);\r\n    }\r\n    if (this.props.required) {\r\n      rule.push({ required: true, message: '必填项' });\r\n    }\r\n    // 数据校验\r\n    validate(rule, value, this.props.bind, (result) => {\r\n      this.setState(result);\r\n      cb && cb(result);\r\n    });\r\n  }\r\n\r\n  onChange = (e) => {\r\n    let value = e;\r\n    if (e.target) {\r\n      value = _.get(e, 'target.value');\r\n      if (value === undefined) {\r\n        value = _.get(e, 'target.checked');\r\n      }\r\n    }\r\n    // 数据校验\r\n    this.onValidate(value);\r\n    // 触发自身onchange\r\n    let values = null;\r\n    if (this.props.onChange) {\r\n      let lastValues = _.cloneDeep(this.props.getValues());\r\n      _.set(lastValues, this.props.bind, value);\r\n      values = this.props.onChange(lastValues, this.props.bind, value);\r\n    }\r\n    // 触发 FormEx 中事件\r\n    this.props.emitChangeToParent(values, this.props.bind, value);\r\n  }\r\n\r\n  render() {\r\n    // console.log('===========================')\r\n    let children = this.props.children;\r\n    // 如果存在bind值，则作为表单控件进行处理\r\n    if (_.isPlainObject(children) && this.props.bind) {\r\n      // console.log('------------------');\r\n      // console.log(children);\r\n      // console.log(Checkbox._name);\r\n      // console.log(children.type._name === Checkbox._name);\r\n      // console.log(children);\r\n      if (children.type._name === Checkbox._name) {\r\n        children = React.cloneElement(this.props.children, {\r\n          onChange: this.onChange,\r\n          checked: this.props.value === undefined ? this.props.defaultValue : this.props.value,\r\n        });\r\n      } else if (children.type._name === Select._name && children.props.mode === 'tags') {\r\n        children = React.cloneElement(this.props.children, {\r\n          onChange: this.onChange,\r\n          defaultValue: this.props.value ? this.props.value : [],\r\n        });\r\n      } else if (children.type._name === Input._name || children.type._name === Select._name || children.type._name === TextArea._name) {\r\n        children = React.cloneElement(this.props.children, {\r\n          onChange: this.onChange,\r\n          value: this.props.value === undefined ? this.props.defaultValue : this.props.value,\r\n        });\r\n      } else {\r\n        children = React.cloneElement(this.props.children, {\r\n          onChange: this.onChange,\r\n          value: this.props.value === undefined ? this.props.defaultValue : this.props.value,\r\n        });\r\n      }\r\n    }\r\n    return (\r\n      <FormItem {...this.props} help={this.state.message} validateStatus={this.state.status} onValidate={this.onValidate}>\r\n        {children}\r\n      </FormItem>\r\n    )\r\n  }\r\n}\r\n\r\nFormExItem._name = 'FormExItem';\r\n\r\nclass FormExItemArray extends Component {\r\n\r\n  static defaultProps = {\r\n    span: null, // 布局，[3,4,4] 如果为空，则根据子节点个数平均分配\r\n    addText: '新增', // 布局，[3,4,4] 如果为空，则根据子节点个数平均分配\r\n  }\r\n\r\n  onAddItem = () => {\r\n    let values = _.cloneDeep(this.props.values);\r\n    let list = _.get(values, this.props.bind, []);\r\n    list.push({});\r\n    this.props.emitChangeToParent(values, this.props.bind, list);\r\n  }\r\n\r\n  onDelItem = (index) => {\r\n    let values = _.cloneDeep(this.props.values);\r\n    let list = _.get(values, this.props.bind);\r\n    list.splice(index, 1);\r\n    this.props.emitChangeToParent(values, this.props.bind, list);\r\n  }\r\n\r\n  render() {\r\n    // console.info('this', this);\r\n    // console.info('this.props', this.props);\r\n    let children = [];\r\n    let value = this.props.value || [];\r\n    let items = React.Children.toArray(this.props.children);\r\n    let span = this.props.span;\r\n    if (this.props.span === null) {\r\n      let s = Math.floor((24 - 2) / items.length);\r\n      span = _.fill(new Array(items.length), s, 0);\r\n    }\r\n    value.forEach((x, i) => {\r\n      let cols = [];\r\n      items.forEach((element, index) => {\r\n        let id = `${this.props.bind}[${i}].${element.props.bind}`;\r\n        if (this.props.defaultValues) {\r\n          this.props.defaultValues.push({ bind: id, defaultValue: element.props.defaultValue });\r\n        }\r\n        let item = React.cloneElement(element, {\r\n          bind: id,\r\n          value: _.get(this.props.values, id),\r\n          ruleOfForm: this.props.rules[id],\r\n          ref: item => {\r\n            if (item)\r\n              this.props.items.push(item);\r\n          },\r\n          defaultValue: _.get(this.props.values, id) || element.props.defaultValue,\r\n          emitChangeToParent: this.props.emitChangeToParent,\r\n          getValues: this.props.getValues\r\n        });\r\n        cols.push(<Col span={span[index]} key={id}>{item}</Col>);\r\n      });\r\n      cols.push(\r\n        <Col span={2} key={i+'del'}>\r\n          <Icon className=\"dynamic-delete-button\" type=\"minus-circle-o\" style={{marginLeft: '12px'}} onClick={() => { this.onDelItem(i); }}/>\r\n        </Col>)\r\n      let row = <Row gutter={8} key={i} style={{paddingBottom: '10px'}}>{cols}</Row>;\r\n      children.push(row);\r\n    });\r\n\r\n    return (\r\n      <FormExItem {...this.props} bind={null} items={children}>\r\n        {children}\r\n        <Button type=\"dashed\" onClick={this.onAddItem} style={{ width: '50%' }}>\r\n          <Icon type=\"plus\" /> {this.props.addText}\r\n        </Button>\r\n      </FormExItem>\r\n    )\r\n  }\r\n}\r\n\r\nFormExItemArray._name = 'FormExItemArray';\r\n\r\nFormEx.Item = FormExItem;\r\nFormEx.ItemArray = FormExItemArray;"]}