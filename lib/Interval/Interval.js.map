{"version":3,"sources":["../../components/Interval/Interval.jsx"],"names":["React","Component","_","moment","Interval","props","setText","time","second","text","render","Math","round","interval","setState","state","nextProps","lastUpdate","countdownSecond","unix","countdown","minute","format","countdownFormat","setInterval","onTrigger","repeat","clearInterval","space","className","style","defaultProps"],"mappings":";;;;;;;;AAAA;;;;;;;;;;;;;AAaA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,CAAP,MAAc,QAAd;AACA,OAAOC,MAAP,MAAmB,QAAnB;;IAEMC,Q;;;AACJ,oBAAYC,KAAZ,EAAmB;AAAA;;AAAA,oHACXA,KADW;;AAAA,UA6CnBC,OA7CmB,GA6CT,UAACC,IAAD,EAAOC,MAAP,EAAkB;AAC1B,UAAIC,OAAO,EAAX;AACA,UAAI,MAAKJ,KAAL,CAAWK,MAAf,EAAuB;AACrBD,eAAO,MAAKJ,KAAL,CAAWK,MAAX,CAAkBH,IAAlB,EAAwBC,MAAxB,CAAP;AACD,OAFD,MAEO;AACLC,0BAAWE,KAAKC,KAAL,CAAW,MAAKP,KAAL,CAAWQ,QAAX,GAAsB,EAAjC,CAAX,kDAAyDN,IAAzD;AACD;AACD,YAAKO,QAAL,CAAc,EAAEL,UAAF,EAAd;AACD,KArDkB;;AAEjB,UAAKM,KAAL,GAAa;AACXN,YAAM;AADK,KAAb;AAFiB;AAKlB;;;;8CAayBO,S,EAAW,CAAE;;;wCAEnB;AAAA;;AAClB,WAAKC,UAAL,GAAkBd,QAAlB;AACA,UAAIe,kBAAkB,KAAKb,KAAL,CAAWQ,QAAX,IAAuBV,SAASgB,IAAT,KAAkB,KAAKF,UAAL,CAAgBE,IAAhB,EAAzC,CAAtB;AACA,UAAIC,YAAYjB,OAAO,EAAEkB,QAAQH,kBAAkB,EAA5B,EAAgCV,QAAQU,kBAAkB,EAA1D,EAAP,CAAhB;AACA,WAAKZ,OAAL,CAAac,UAAUE,MAAV,CAAiB,KAAKjB,KAAL,CAAWkB,eAA5B,CAAb,EAA2DL,eAA3D;;AAEA,WAAKL,QAAL,GAAgBW,YAAY,YAAM;AAChC,YAAIN,kBAAkB,OAAKb,KAAL,CAAWQ,QAAX,IAAuBV,SAASgB,IAAT,KAAkB,OAAKF,UAAL,CAAgBE,IAAhB,EAAzC,CAAtB;AACA,YAAIC,YAAYjB,OAAO,EAAEkB,QAAQH,kBAAkB,EAA5B,EAAgCV,QAAQU,kBAAkB,EAA1D,EAAP,CAAhB;AACA,eAAKZ,OAAL,CAAac,UAAUE,MAAV,CAAiB,OAAKjB,KAAL,CAAWkB,eAA5B,CAAb,EAA2DL,eAA3D;AACA,YAAIA,mBAAmB,CAAvB,EAA0B;AACxB,iBAAKD,UAAL,GAAkBd,QAAlB;AACA,iBAAKE,KAAL,CAAWoB,SAAX,IAAwB,OAAKpB,KAAL,CAAWoB,SAAX,EAAxB;AACA;AACA,cAAI,OAAKpB,KAAL,CAAWqB,MAAX,KAAsB,KAA1B,EAAiC;AAC/BC,0BAAc,OAAKd,QAAnB;AACD;AACF;AACF,OAZe,EAYb,KAAKR,KAAL,CAAWuB,KAAX,GAAmB,IAZN,CAAhB;AAaD;;;2CAEsB;AACrBD,oBAAc,KAAKd,QAAnB;AACD;;;6BAYQ;AACP,aACE;AAAA;AAAA,UAAM,WAAW,KAAKR,KAAL,CAAWwB,SAA5B,EAAuC,OAAO,KAAKxB,KAAL,CAAWyB,KAAzD;AAAiE,aAAKf,KAAL,CAAWN;AAA5E,OADF;AAGD;;;;EA5DoBR,S;;AAAjBG,Q,CAQG2B,Y,GAAe;AACpBF,aAAW,IADS;AAEpBC,SAAO,IAFa;AAGpBjB,YAAU,GAHU,EAGL;AACfe,SAAO,CAJa,EAIV;AACVlB,UAAQ,IALY,EAKN;AACde,aAAW,IANS,EAMH;AACjBC,UAAQ,IAPY,EAON;AACdH,mBAAiB,OARG,CAQM;AARN,C;;;AAuDxB,eAAenB,QAAf","file":"Interval.js","sourcesContent":["/*\r\n 定时器\r\n\r\n <Interval onTrigger={()=> console.log('Interval Trigger')} />\r\n\r\n <Interval \r\n  interval={60} \r\n  space={2} \r\n  render={(time, second) => `自定义显示:${time}，秒：${second}`} \r\n  repeat={false}\r\n  onTrigger={()=> console.log('Interval Trigger')}\r\n />\r\n */\r\nimport React, { Component } from 'react';\r\nimport _ from 'lodash';\r\nimport moment from 'moment';\r\n\r\nclass Interval extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      text: ''\r\n    };\r\n  }\r\n\r\n  static defaultProps = {\r\n    className: null,\r\n    style: null,\r\n    interval: 600, // 定时多久后进行校验 默认10分钟\r\n    space: 1, // 间隔多久校验一次，默认1秒\r\n    render: null, // 每次校验时执行函数，参数为倒计时字符串 (time, second) => time\r\n    onTrigger: null, // 倒计时最后执行函数\r\n    repeat: true, // 是否循环\r\n    countdownFormat: 'mm:ss', // 倒计时格式化\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps) {}\r\n\r\n  componentDidMount() {\r\n    this.lastUpdate = moment();\r\n    let countdownSecond = this.props.interval - (moment().unix() - this.lastUpdate.unix());\r\n    let countdown = moment({ minute: countdownSecond / 60, second: countdownSecond % 60 });\r\n    this.setText(countdown.format(this.props.countdownFormat), countdownSecond);\r\n\r\n    this.interval = setInterval(() => {\r\n      let countdownSecond = this.props.interval - (moment().unix() - this.lastUpdate.unix());\r\n      let countdown = moment({ minute: countdownSecond / 60, second: countdownSecond % 60 });\r\n      this.setText(countdown.format(this.props.countdownFormat), countdownSecond);\r\n      if (countdownSecond <= 0) {\r\n        this.lastUpdate = moment();\r\n        this.props.onTrigger && this.props.onTrigger();\r\n        // 移除定时器\r\n        if (this.props.repeat === false) {\r\n          clearInterval(this.interval);\r\n        }\r\n      }\r\n    }, this.props.space * 1000);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    clearInterval(this.interval);\r\n  }\r\n\r\n  setText = (time, second) => {\r\n    let text = '';\r\n    if (this.props.render) {\r\n      text = this.props.render(time, second);\r\n    } else {\r\n      text = `每${Math.round(this.props.interval / 60)}分钟更新一次，${time}后更新`;\r\n    }\r\n    this.setState({ text });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <span className={this.props.className} style={this.props.style}>{this.state.text}</span>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Interval;"]}