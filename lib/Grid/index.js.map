{"version":3,"sources":["../../src/Grid/index.jsx"],"names":["React","Component","Table","_","PAGE_SIZE","Grid","props","onChange","pagination","filters","sorter","console","info","params","config","getPage","current","pageSize","paramsOfFilter","paramsOfSort","paramsOfChange","Object","keys","length","onFilter","onSort","assign","api","getData","setPage","num","state","set","setState","loading","dataSource","nextProps","isEqual","data","history","setTimeout","componentDidMount","isEmpty","draw","size","total","list","lastHistory","get","then","onResHandler","res","forEach","x","index","_key","catch","className","style","defaultProps","defaultPageSize","columns","rowKey","scroll","defaultCurrent","showSizeChanger","showQuickJumper","rowSelection"],"mappings":"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","file":"index.js","sourcesContent":["﻿import React, { Component } from 'react';\r\nimport { Table } from 'antd';\r\nimport _ from 'lodash';\r\nimport './style.scss';\r\n\r\nconst PAGE_SIZE = 30;\r\n\r\nexport default class Grid extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      loading: false,\r\n      pagination: props.pagination,\r\n      dataSource: []\r\n    };\r\n  }\r\n\r\n  static defaultProps = {\r\n    className: '',\r\n    style: {},\r\n    api: null, // 接口，当传入该参数时，请勿传入data。 () => {}\r\n    history: [], // 该字段用于刷新表格数据，当向该字段中插入请求参数时，重新请求刷新表格。api参数必填\r\n    params: {}, // 该参数优先级高于histroy中参数\r\n    data: null, // 包含分页,条目项等所有数据 { data: [], page_now, page_rows, records }\r\n    onChange: (pagination, filters, sorter) => {}, // 页码，条目数，排序，过滤器等变更事件，可返回请求参数\r\n    onSort: (sorter) => {}, // 排序变更事件，可返回请求参数，该参数将合并页码等参数\r\n    onFilter: (filters) => {}, // 过滤器变更事件，可返回参数，该参数将合并页码等参数\r\n    config: {\r\n      defaultPageSize: 30,\r\n      list: 'list',\r\n      size: 'size',\r\n      current: 'current',\r\n      getPage: 'getPage',\r\n      pageSize: 'pageSize',\r\n      total: 'records'\r\n    },\r\n    onResHandler: res => res,\r\n    // 以下参数参照 ant table\r\n    columns: [],\r\n    rowKey: '_key',\r\n    dataSource: [], // 只有列表数据,在data中传入\r\n    size: 'middle',\r\n    loading: false,\r\n    scroll: {},\r\n    pagination: {\r\n      defaultPageSize: PAGE_SIZE,\r\n      defaultCurrent: 1,\r\n      current: 1,\r\n      onChange: () => {},\r\n      showSizeChanger: true,\r\n      showQuickJumper: true,\r\n    },\r\n    rowSelection: null\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps) {\r\n    // 数据未发生变更时，不做刷新\r\n    if (_.isEqual(this.props.data, nextProps.data) &&\r\n      _.isEqual(this.props.history, nextProps.history)) {\r\n      return;\r\n    }\r\n    setTimeout(() => {\r\n      this.componentDidMount(nextProps);\r\n    });\r\n  }\r\n\r\n  componentDidMount(nextProps) {\r\n    if (this.props.api) {\r\n      this.getData();\r\n      return;\r\n    }\r\n    if (_.isEmpty(this.props.data)) {\r\n      return;\r\n    }\r\n    this.draw(this.props.data);\r\n  }\r\n\r\n  draw(data) {\r\n    this.setState(state => {\r\n      let pagination = false;\r\n      if (this.props.pagination) {\r\n        pagination = Object.assign({}, state.pagination, {\r\n          size: this.props.size,\r\n          current: data[this.props.config.current],\r\n          pageSize: data[this.props.config.pageSize],\r\n          total: data[this.props.config.total],\r\n        });\r\n      }\r\n      return {\r\n        dataSource: data[this.props.config.list],\r\n        pagination\r\n      }\r\n    });\r\n  }\r\n\r\n  onChange = (pagination, filters, sorter) => {\r\n    console.info('Grid onChange: ', { pagination, filters, sorter });\r\n    let params = {\r\n      [this.props.config.getPage]: pagination.current,\r\n      [this.props.config.pageSize]: pagination.pageSize\r\n    };\r\n    let paramsOfFilter, paramsOfSort, paramsOfChange;\r\n    if (Object.keys(filters).length > 0 && this.props.onFilter) {\r\n      paramsOfFilter = this.props.onFilter(filters) || {};\r\n    }\r\n    if (Object.keys(sorter).length > 0 && this.props.onSort) {\r\n      paramsOfSort = this.props.onSort(sorter) || {};\r\n    }\r\n    if (this.props.onChange) {\r\n      paramsOfChange = this.props.onChange(pagination, filters, sorter) || {};\r\n    }\r\n    params = Object.assign(params, paramsOfChange, paramsOfFilter, paramsOfSort);\r\n    if (this.props.api) {\r\n      this.getData(params);\r\n    }\r\n  }\r\n\r\n  setPage = (num) => {\r\n    let state = _.set(this.state, 'pagination.current', 1);\r\n    this.setState(state);\r\n  }\r\n\r\n  getData(params) {\r\n    if (this.props.history.length === 0) {\r\n      return;\r\n    }\r\n    let lastHistory = this.props.history[this.props.history.length - 1];\r\n    params = params || {\r\n      [this.props.config.getPage]: _.get(this.state, 'pagination.current', 1),\r\n      [this.props.config.pageSize]: _.get(this.state, 'pagination.pageSize', PAGE_SIZE)\r\n    };\r\n    this.setState({\r\n      loading: true,\r\n    });\r\n    this.props.api(Object.assign({}, lastHistory, params, this.props.params)).then(res => {\r\n      if (this.props.onResHandler) {\r\n        res = this.props.onResHandler(res) || res;\r\n      }\r\n      res[this.props.config.list].forEach((x, index) => {\r\n        x._key = (res[this.props.config.current] - 1) * res[this.props.config.pageSize] + index;\r\n      });\r\n      this.setState({\r\n        loading: false,\r\n        data: res\r\n      });\r\n      this.draw(res);\r\n    }).catch(err => {\r\n      this.setState({\r\n        loading: false,\r\n      });\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className={`nasa-grid ${this.props.className}`} style={this.props.style}>\r\n        <Table\r\n          {...this.props}\r\n          onChange={this.onChange}\r\n          loading={this.state.loading}\r\n          pagination={this.state.pagination} \r\n          dataSource={this.state.dataSource} \r\n        />\r\n      </div>\r\n    )\r\n  }\r\n}"]}